<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Super ChiDog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#6ec6ff}
canvas{display:block}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

const ground = c.height - 90;
const gravity = 1;
const jumpPower = -18;
const speed = 6;

let dead = false;

// DOG
const dog = { x:120, y:ground-40, w:40, h:40, vy:0, rot:0 };

// OBSTACLE
const obstacles = [{
  x: c.width,
  y: ground - 30,
  r: 22
}];

// INPUT
function jump(){
  if(dog.y >= ground-dog.h && !dead){
    dog.vy = jumpPower;
  }
}
addEventListener("touchstart", jump);
addEventListener("mousedown", jump);

// COLLISION
function hit(d,o){
  const cx = Math.max(d.x, Math.min(o.x, d.x+d.w));
  const cy = Math.max(d.y, Math.min(o.y, d.y+d.h));
  const dx = o.x - cx;
  const dy = o.y - cy;
  return dx*dx + dy*dy < o.r*o.r;
}

// LOOP
function loop(){
  ctx.clearRect(0,0,c.width,c.height);

  // ground
  ctx.fillStyle="#3cb043";
  ctx.fillRect(0,ground,c.width,90);

  if(!dead){
    dog.vy += gravity;
    dog.y += dog.vy;
    if(dog.y > ground-dog.h){ dog.y = ground-dog.h; dog.vy=0; }

    obstacles[0].x -= speed;
    if(obstacles[0].x < -50){
      obstacles[0].x = c.width + 200;
    }

    if(hit(dog, obstacles[0])) dead = true;

    if(dog.vy!==0) dog.rot+=0.15;
    else dog.rot=0;
  }

  // obstacle
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(obstacles[0].x, obstacles[0].y, obstacles[0].r, 0, Math.PI*2);
  ctx.fill();

  // dog
  ctx.save();
  ctx.translate(dog.x+dog.w/2, dog.y+dog.h/2);
  ctx.rotate(dog.rot);
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(0,0,dog.w/2,0,Math.PI*2);
  ctx.fill();
  ctx.restore();

  if(dead){
    ctx.fillStyle="#000";
    ctx.font="bold 36px Arial";
    ctx.textAlign="center";
    ctx.fillText("GAME OVER", c.width/2, c.height/2);
  }

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
