<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SuperChidog</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
<style>
html,body { margin:0; padding:0; background:#5ecbff; overflow:hidden; }
canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: 900,
    height: 500,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 1200 },
            debug: false
        }
    },
    scene: { preload, create, update }
};

new Phaser.Game(config);

let player, ground, cursors;
let jumps = 0;
let score = 0;
let health = 10;
let scoreText, healthBar;
let bones, bombs;
let speed = 200;

function preload() {
    this.load.image('sky', 'https://i.imgur.com/YKY28eT.png');
    this.load.image('ground', 'https://i.imgur.com/zp6zZ0k.png');
    this.load.image('cloud', 'https://i.imgur.com/IaUrttj.png');
    this.load.image('mountain', 'https://i.imgur.com/Y7ZKXJg.png');
    this.load.image('tree', 'https://i.imgur.com/zN6Xx7F.png');

    // DOG IMAGE (replace later if you want)
    this.load.image('dog', 'https://i.imgur.com/4AiXzf8.png');

    this.load.image('bone', 'https://i.imgur.com/VxP3LkI.png');
    this.load.image('bomb', 'https://i.imgur.com/W7JQ9hM.png');
}

function create() {
    this.add.tileSprite(0,0,2000,500,'sky').setOrigin(0);

    for (let i=0;i<6;i++){
        this.add.image(200*i,200,'cloud').setScrollFactor(0.3);
        this.add.image(300*i,350,'mountain').setScrollFactor(0.5);
        this.add.image(250*i,420,'tree').setScrollFactor(0.8);
    }

    ground = this.physics.add.staticGroup();
    for (let i=0;i<50;i++){
        ground.create(i*128,480,'ground').setOrigin(0,1).refreshBody();
    }

    player = this.physics.add.sprite(150,300,'dog');
    player.setScale(0.15);
    player.setCollideWorldBounds(false);
    player.body.setSize(300,300);

    this.physics.add.collider(player, ground, () => jumps = 0);

    this.cameras.main.startFollow(player);
    this.cameras.main.setBounds(0,0,100000,500);

    bones = this.physics.add.group();
    bombs = this.physics.add.group();

    this.time.addEvent({
        delay: 1500,
        loop: true,
        callback: () => spawnItem(this)
    });

    scoreText = this.add.text(20,20,'Score: 0',{font:'20px Arial',fill:'#000'}).setScrollFactor(0);
    healthBar = this.add.graphics().setScrollFactor(0);

    cursors = this.input.keyboard.createCursorKeys();

    this.input.on('pointerdown', () => jump());

    this.physics.add.overlap(player,bones,collectBone,null,this);
    this.physics.add.overlap(player,bombs,hitBomb,null,this);
}

function update() {
    player.setVelocityX(speed);

    if (!player.body.touching.down) {
        player.angle += 8;
    } else {
        player.angle = 0;
    }

    drawHealth();
}

function jump() {
    if (jumps < 2) {
        player.setVelocityY(-500);
        jumps++;
    }
}

function spawnItem(scene) {
    let x = player.x + 800;
    let y = Phaser.Math.Between(200,350);

    if (Math.random() < 0.7) {
        let bone = bones.create(x,y,'bone');
        bone.setVelocityX(-speed);
    } else {
        let bomb = bombs.create(x,y,'bomb');
        bomb.setVelocityX(-speed);
    }
}

function collectBone(player,bone) {
    score += Phaser.Math.Between(1,20);
    scoreText.setText('Score: ' + score);
    bone.destroy();
}

function hitBomb(player,bomb) {
    health--;
    bomb.destroy();
    if (health <= 0) {
        this.scene.restart();
        score = 0;
        health = 10;
    }
}

function drawHealth() {
    healthBar.clear();
    healthBar.fillStyle(0xff0000);
    healthBar.fillRect(20,50,200,20);
    healthBar.fillStyle(0x00ff00);
    healthBar.fillRect(20,50,200*(health/10),20);
}
</script>

</body>
</html>
