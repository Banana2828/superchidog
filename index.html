<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SuperChiDog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
body { margin:0; background:#5c94fc; }
canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<script>
const config = {
  type: Phaser.AUTO,
  width: 960,
  height: 540,
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 900 },
      debug: false
    }
  },
  scene: { preload, create, update }
};

let player, cursors, scoreText, healthText;
let score = 0;
let health = 10;

new Phaser.Game(config);

function preload () {
  this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
  this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
  this.load.image('bone', 'https://labs.phaser.io/assets/sprites/star.png');
  this.load.image('bomb', 'https://labs.phaser.io/assets/sprites/bomb.png');
  this.load.spritesheet('dog',
    'https://labs.phaser.io/assets/sprites/mushroom-32x32.png',
    { frameWidth: 32, frameHeight: 32 }
  );
}

function create () {
  this.add.image(480, 270, 'sky').setScrollFactor(0);

  const platforms = this.physics.add.staticGroup();

  for (let x = 0; x < 4000; x += 400) {
    platforms.create(x, 520, 'ground').setScale(2).refreshBody();
  }

  player = this.physics.add.sprite(100, 400, 'dog');
  player.setBounce(0.1);
  player.setCollideWorldBounds(false);

  this.physics.add.collider(player, platforms);

  this.cameras.main.setBounds(0, 0, 4000, 540);
  this.physics.world.setBounds(0, 0, 4000, 540);
  this.cameras.main.startFollow(player, true, 0.08, 0.08);

  const bones = this.physics.add.group({
    key: 'bone',
    repeat: 50,
    setXY: { x: 200, y: 0, stepX: 70 }
  });

  bones.children.iterate(b => {
    b.setBounceY(Phaser.Math.FloatBetween(0.3, 0.6));
  });

  const bombs = this.physics.add.group();

  for (let i = 0; i < 10; i++) {
    let bomb = bombs.create(600 + i * 300, 0, 'bomb');
    bomb.setBounce(1);
    bomb.setCollideWorldBounds(true);
    bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);
  }

  this.physics.add.collider(bones, platforms);
  this.physics.add.collider(bombs, platforms);

  this.physics.add.overlap(player, bones, collectBone, null, this);
  this.physics.add.collider(player, bombs, hitBomb, null, this);

  cursors = this.input.keyboard.createCursorKeys();

  scoreText = this.add.text(16, 16, 'Score: 0', {
    fontSize: '20px',
    fill: '#fff'
  }).setScrollFactor(0);

  healthText = this.add.text(16, 40, 'Health: 10', {
    fontSize: '20px',
    fill: '#fff'
  }).setScrollFactor(0);

  this.input.on('pointerdown', () => {
    if (player.body.touching.down) {
      player.setVelocityY(-520);
    } else if (player.body.velocity.y > -200) {
      player.setVelocityY(-420);
    }
  });
}

function update () {
  if (cursors.left.isDown) {
    player.setVelocityX(-220);
  } else if (cursors.right.isDown) {
    player.setVelocityX(220);
  } else {
    player.setVelocityX(0);
  }

  if (cursors.up.isDown && player.body.touching.down) {
    player.setVelocityY(-520);
  }
}

function collectBone (player, bone) {
  bone.disableBody(true, true);
  const pts = Phaser.Math.Between(1, 20);
  score += pts;
  scoreText.setText('Score: ' + score);
}

function hitBomb (player, bomb) {
  health--;
  healthText.setText('Health: ' + health);
  bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);

  if (health <= 0) {
    this.physics.pause();
    player.setTint(0xff0000);
  }
}
</script>

</body>
</html>
